<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafe24 OAuth 인증 관리 툴</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>☕ Cafe24 OAuth 인증 관리 툴</h1>
            <p class="subtitle">로컬에서 간편하게 Cafe24 API 인증을 관리하세요</p>
        </header>

        <!-- 계정 목록 -->
        <section class="card" id="accounts-section">
            <h2>📋 등록된 계정 목록</h2>
            <p class="section-description">여러 쇼핑몰의 계정을 관리할 수 있습니다. 계정을 클릭하여 전환하세요.</p>

            <div id="accounts-list">
                <div class="loading">계정 목록을 불러오는 중...</div>
            </div>
        </section>

        <!-- 단계 표시 -->
        <div class="steps">
            <div class="step active" id="step-config">
                <div class="step-number">1</div>
                <div class="step-title">앱 정보 입력</div>
            </div>
            <div class="step" id="step-auth">
                <div class="step-number">2</div>
                <div class="step-title">OAuth 인증</div>
            </div>
            <div class="step" id="step-token">
                <div class="step-number">3</div>
                <div class="step-title">토큰 관리</div>
            </div>
        </div>

        <!-- 앱 설정 섹션 -->
        <section class="card" id="config-section">
            <h2>🔧 앱 정보 설정</h2>
            <p class="section-description">Cafe24 개발자센터에서 생성한 앱 정보를 입력하세요.</p>

            <form id="config-form">
                <div class="form-group">
                    <label for="app_url">App URL</label>
                    <input type="text" id="app_url" name="app_url"
                           placeholder="https://ecudemo378885.cafe24.com"
                           value="{{ config.app_url or '' }}">
                    <small>쇼핑몰 도메인 (Shop ID가 자동으로 추출됩니다)</small>
                </div>

                <div class="form-group">
                    <label for="redirect_uri">Redirect URI</label>
                    <input type="text" id="redirect_uri" name="redirect_uri"
                           placeholder="https://ecudemo378885.cafe24.com/product/list.html"
                           value="{{ config.redirect_uri or '' }}">
                    <small>Cafe24 앱 설정에 등록한 Redirect URI</small>
                </div>

                <div class="form-group">
                    <label for="client_id">Client ID</label>
                    <input type="text" id="client_id" name="client_id"
                           placeholder="thZiFhagB1OmJWEqBGV7NC"
                           value="{{ config.client_id or '' }}">
                </div>

                <div class="form-group">
                    <label for="client_secret">Client Secret Key</label>
                    <input type="password" id="client_secret" name="client_secret"
                           placeholder="FXOf1lxJFqxS5XXGnU0G7A"
                           value="{{ config.client_secret or '' }}">
                    <button type="button" class="toggle-password" onclick="togglePassword('client_secret')">👁️</button>
                </div>

                <div class="form-group">
                    <label for="service_key">Service Key</label>
                    <input type="password" id="service_key" name="service_key"
                           placeholder="WQP+PGMMROxMmPwXgtVj8tXVxP2WDcyfhC58PVF1epM="
                           value="{{ config.service_key or '' }}">
                    <button type="button" class="toggle-password" onclick="togglePassword('service_key')">👁️</button>
                </div>

                <div class="form-group">
                    <label>API 권한 선택 (Scopes)</label>
                    <small>Cafe24 앱 설정에서 선택한 권한과 동일하게 선택하세요</small>
                    <div class="scope-checkboxes">
                        <label><input type="checkbox" name="scope" value="mall.read_application" checked> 앱 읽기</label>
                        <label><input type="checkbox" name="scope" value="mall.write_application" checked> 앱 쓰기</label>
                        <label><input type="checkbox" name="scope" value="mall.read_category" checked> 상품분류 읽기</label>
                        <label><input type="checkbox" name="scope" value="mall.write_category" checked> 상품분류 쓰기</label>
                        <label><input type="checkbox" name="scope" value="mall.read_product" checked> 상품 읽기</label>
                        <label><input type="checkbox" name="scope" value="mall.write_product" checked> 상품 쓰기</label>
                        <label><input type="checkbox" name="scope" value="mall.read_order"> 주문 읽기</label>
                        <label><input type="checkbox" name="scope" value="mall.write_order"> 주문 쓰기</label>
                        <label><input type="checkbox" name="scope" value="mall.read_customer"> 고객 읽기</label>
                        <label><input type="checkbox" name="scope" value="mall.write_customer"> 고객 쓰기</label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">💾 설정 저장</button>
            </form>

            <div id="config-message" class="message"></div>
        </section>

        <!-- OAuth 인증 섹션 -->
        <section class="card" id="auth-section">
            <h2>🔐 OAuth 인증</h2>
            <p class="section-description">
                버튼을 클릭하면 새 창에서 Cafe24 인증 페이지가 열립니다.<br>
                <strong>⚠️ 인증코드는 1분간만 유효합니다!</strong>
            </p>

            <button id="start-auth-btn" class="btn btn-success" onclick="startAuth()">
                🚀 인증 시작하기
            </button>

            <div id="auth-message" class="message"></div>
        </section>

        <!-- 토큰 관리 섹션 -->
        <section class="card" id="token-section">
            <h2>🎫 토큰 관리</h2>

            <div id="token-status" class="token-info">
                <div class="loading">토큰 정보를 불러오는 중...</div>
            </div>

            <div class="button-group">
                <button class="btn btn-warning" onclick="refreshToken()">🔄 토큰 갱신</button>
                <button class="btn btn-info" onclick="testApi()">🧪 API 테스트</button>
            </div>

            <div id="token-message" class="message"></div>
        </section>

        <!-- API 테스트 결과 -->
        <section class="card" id="api-test-section" style="display: none;">
            <h2>📊 API 테스트 결과</h2>
            <pre id="api-result"></pre>
        </section>

        <footer>
            <p>Cafe24 OAuth 인증 관리 툴 v1.0</p>
            <p>로컬에서만 실행되며, 모든 데이터는 로컬에 저장됩니다.</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
